---
title: "p8105_hw2_zj2379"
author: "Zheshu Jiang"
date: "2023-10-02"
output: github_document
---

##Problem 1
First, clean the data in pols-month.csv. Use separate() to break up the variable mon into integer variables year, month, and day; replace month number with month name; create a president variable taking values gop and dem, and remove prez_dem and prez_gop; and remove the day variable.
```{r}
library(tidyverse)
```

```{r}
month_df = 
  tibble(
    month_num = 1:12,
    month_abb = month.abb,
    month = month.name
  )
```

Clean the data in pols-month.csv
```{r}
pols=
  read_csv("./data/fivethirtyeight_datasets/pols-month.csv",show_col_types = FALSE) %>%
  janitor::clean_names() %>% 
  separate(mon,into=c("year","month","day"),sep="-") %>% 
  mutate_at(vars(year, month, day), as.numeric) %>% 
  mutate(month=recode(month, '01'="January" , '02'="February",'03'="March",'04'="April","05"="May","06"="June","07"="July","08"="August","09"="Septemer","10"="October","11"="November","12"="December")) %>% 
   mutate(president = recode(prez_gop, "0" = "dem", "1" = "gop", "2" = "gop")) |>
  left_join(x = _, y = month_df) %>% 
  select(year, month, everything(), -day, -starts_with("prez"))
```
Second, clean the data in snp.csv using a similar process to the above. For consistency across datasets, arrange according to year and month, and organize so that year and month are the leading columns.

```{r}
snp = 
  read_csv("./data/fivethirtyeight_datasets/snp.csv") %>% 
  janitor::clean_names() %>% 
  separate(date, into = c("month", "day", "year"), convert = TRUE) %>% 
  arrange(year, month) %>% 
  mutate(month = month.name[month]) %>% 
  select(year, month, close) 
```

Third, tidy the unemployment data so that it can be merged with the previous datasets. This process will involve switching from “wide” to “long” format; ensuring that key variables have the same name; and ensuring that key variables take the same values.

```{r clean_538_unemp}
unemployment = 
  read_csv("./data/fivethirtyeight_datasets/unemployment.csv") %>%
   rename(year = Year) %>% 
  pivot_longer(
    Jan:Dec, 
    names_to = "month_abb",
    values_to = "unemployment"
  ) |> 
  left_join(x = _, y = month_df) %>% 
  select(year, month, unemployment)
```
Join the datasets by merging snp into pols, and merging unemployment into the result.
```{r merge_538}
data_538 = 
  left_join(pols, snp)|>
  left_join(x = _, y = unemployment)
```

## problem 2

```{r}
library(readxl)
```

```{r}
mrtrashweel=
  #read the Mr. Trash Wheel sheet
   read_excel("./data/202207 Trash Wheel Collection Data.xlsx", sheet="Mr. Trash Wheel") %>%
  #clean the dataset and filter out missing values
  janitor::clean_names() %>%
  filter(if_any(everything(), ~ !is.na(.)))%>%
  #update the homes_powered values
  mutate(homes_powered=(500*weight_tons)/30) %>%  
  #remove desimal points from homes_powered values
  mutate(homes_powered=trunc(homes_powered)) %>% 
  #remove some columns
  select(-x15,-x16) %>% 
  #convert year from character to numeric variable
  mutate_at(vars(year), as.numeric)


mrtrashweel
```

Use a similar process to import, clean, and organize the data for Professor Trash Wheel and Gwynnda, and combine these with the Mr. Trash Wheel dataset to produce a single tidy dataset. To keep track of which Trash Wheel is which, you may need to add an additional variable to all datasets before combining.
```{r}
gwynndatrashweel=
  #read the Gwynnda Trash Wheel sheet
   read_excel("./data/202207 Trash Wheel Collection Data.xlsx", sheet="Gwynnda Trash Wheel") %>% 
  #clean the dataset and filter out missing values
  janitor::clean_names() %>%filter(if_any(everything(), ~ !is.na(.))) %>% 
  #update the homes_powered values
  mutate(homes_powered=(500*weight_tons)/30) %>%  
  #remove desimal points from homes_powered values
  mutate(homes_powered=trunc(homes_powered))

gwynndatrashweel
```
```{r}
professortrashweel=
  #read the Professor Trash Wheel sheet
   read_excel("./data/202207 Trash Wheel Collection Data.xlsx", sheet="Professor Trash Wheel") %>% 
  #clean the dataset and filter out missing values
  janitor::clean_names() %>%filter(if_any(everything(), ~ !is.na(.))) %>% 
  #update the homes_powered values
  mutate(homes_powered=(500*weight_tons)/30) %>%  
  #remove desimal points from homes_powered values
  mutate(homes_powered=trunc(homes_powered))

professortrashweel
```


```{r}
#merge three datasets
data_combine = 
  left_join(mrtrashweel,professortrashweel)|>
  left_join(x = _, y = gwynndatrashweel)
data_combine
```


Write a paragraph about these data; you are encouraged to use inline R. Be sure to note the number of observations in the resulting dataset, and give examples of key variables. For available data, what was the total weight of trash collected by Professor Trash Wheel? What was the total number of cigarette butts collected by Gwynnda in July of 2021?

```{r}
#create a sub-dataset from gwynndajuly only have the observations from july
gwynndajuly <- filter(gwynndatrashweel, month == "July")
#calculate the sum of igarette_butts
sum(gwynndajuly$cigarette_butts) 
```

The `mrtrashweel` data has `r nrow(mrtrashweel)` obervations and `r ncol(mrtrashweel)` variables and tells us about the weight of different types of trash for a given year from years 2014 to 2022 to power the number of homes ranging from `r range(mrtrashweel$homes_powered)[1]` to `r range(mrtrashweel$homes_powered)[2]`. 

The `professortrashweel` data has `r nrow(professortrashweel)` obervations and `r ncol(professortrashweel)` variables and tells us about the weight of different types of trash for a given year from years 2017 to 2022 to power the number of homes ranging from `r range(professortrashweel$homes_powered)[1]` to `r range(professortrashweel$homes_powered)[2]`. 

The `gwynndatrashweel` data has `r nrow(gwynndatrashweel)` obervations and `r ncol(gwynndatrashweel)` variables and tells us about the weight of different types of trash for a given year from years 2021 to 2022 to power the number of homes ranging from `r range(gwynndatrashweel$homes_powered)[1]` to `r range(gwynndatrashweel$homes_powered)[2]`. 

The `data_combine` data has `r nrow(data_combine)` obervations and `r ncol(data_combine)` variables and tells us about the weight of different types of trash for a given year from years 2014 to 2022 to power the number of homes ranging from `r range(data_combine$homes_powered)[1]` to `r range(data_combine$homes_powered)[2]`. 

The total weight of trash collected by Professor Trash Wheel is `r sum(professortrashweel$weight_tons)`tons and the total number of cigarette butts collected by Gwynnda in July of 2021 is `r sum(gwynndajuly$cigarette_butts)`.

## Problem 3

Similarly, import, clean, and tidy the dataset of longitudinally observed biomarker values; comment on the steps on the import process and the features of the dataset.

Check whether some participants appear in only the baseline or amyloid datasets, and comment on your findings. Combine the demographic and biomarker datasets so that only participants who appear in both datasets are retained, and briefly describe the resulting dataset; export the result as a CSV to your data directory.

```{r}
baseline=
  #read and clean the data 
  read_csv("./data/data_mci/MCI_baseline.csv") %>% 
  janitor::clean_names() %>% 
  #remove observations those do not meet the stated inclusion criteria 
 filter(age_at_the_onset_of_mci_missing_if_a_subject_remains_mci_free_during_the_follow_up_period != ".") %>% 
  # Ensure that sex and APOE4 carrier status are appropriate encoded
  mutate(x1_male_0_female=recode(x1_male_0_female,'1'="male",'0'="female")) %>% 
  mutate(x1_apoe4_carrier_0_apoe4_non_carrier=recode(x1_apoe4_carrier_0_apoe4_non_carrier,"1"="carrier","0"="non-carrier")) %>% 
  #change the column name
   rename("sex" = "x1_male_0_female",
          "apoe4_status"="x1_apoe4_carrier_0_apoe4_non_carrier",
          "age_at_the_onset_of_mci"="age_at_the_onset_of_mci_missing_if_a_subject_remains_mci_free_during_the_follow_up_period") %>%   rename("ID"="x1") %>% 
  #convert age from char to num
   mutate_at(vars(age_at_the_study_baseline), as.numeric) %>% 
  #remove the first row
  slice(-1)
baseline
```

```{r}
#calculate proportion of women in the study are APOE4 carriers 
carrier <- filter(baseline, apoe4_status == "carrier")
femaleproportion <- (nrow(filter(carrier, sex=="female")) / nrow(carrier))*100
```

I import the daseline dataset and clean it by removing observations without MCI records. There were originally 483 participants, `r nrow(baseline)` of them have developed MCI. The average baseline age is `r mean(baseline$age_at_the_study_baseline)`. `r femaleproportion`% of women in the study are APOE4 carriers.

```{r}
amyloid=
  #read and clean the data 
  read_csv("./data/data_mci/mci_amyloid.csv", na = c("Na", "NA", "N/A")) %>% 
  janitor::clean_names() %>% 
  slice(-1) %>% 
  rename("time_since_baseline"="time_in_years_elapsed_since_the_study_baseline_to_the_visit_where_biomarker_amyloid_42_40_ratio_was_measured",
         "ID"="study_id",
         "time2"="na_3",
         "time4"="na_4",
         "time6"="na_5",
         "time8"="na_6"
  ) %>% 
  #remove obs with NA values
  na.omit(amyloid)

amyloid
```

I first rename each column and remove observations with missing values. There were originally 496 individuals, while only `r nrow(amyloid)` of them have completed records.

```{r}
# Find participants unique to the "baseline" dataset
baseline_unique <- baseline %>%
  anti_join(amyloid, by = "ID")
nrow(baseline_unique)
# Find participants unique to the "amyloid" dataset
amyloid_unique <- amyloid %>%
  anti_join(baseline, by = "ID")
nrow(amyloid_unique)
# Combine the datasets, retaining only participants common to both datasets
combined_data2 <- inner_join(baseline, amyloid, by = "ID")
nrow(combined_data2)
```
`r nrow(baseline_unique)` participants found unique to the baseline dataset and `r nrow(amyloid_unique)` participants found unique to the amyloid dataset. `r nrow(combined_data2)` appear in both datasets.


